name: Deploy Next.js to Cloudflare Pages

on:
  push:
    branches:
      - main # Cháº¡y khi cÃ³ code Ä‘Æ°á»£c Ä‘áº©y lÃªn nhÃ¡nh main

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: â¬‡ï¸ Checkout code
        uses: actions/checkout@v4

      - name: âš™ï¸ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20' 
          # Thiáº¿t láº­p Ä‘á»ƒ sá»­ dá»¥ng pnpm náº¿u báº¡n Ä‘ang dÃ¹ng pnpm (nhÆ° trong hÃ¬nh)
          cache: 'pnpm' 

      - name: ğŸ“¦ Install dependencies
        run: pnpm install # Sá»­a thÃ nh pnpm install

      - name: ğŸ› ï¸ Build and Deploy
        uses: cloudflare/pages-action@v1
        with:
          apiToken: ${{ secrets.CLOUDFLARE_API_TOKEN }}
          accountId: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }}
          projectName: ptit # DÃ¹ng tÃªn Project mÃ  báº¡n Ä‘Ã£ Ä‘áº·t trÃªn Cloudflare Pages
          
          # Lá»‡nh Build: Cáº§n cháº¡y lá»‡nh build cá»§a Next.js, sau Ä‘Ã³ lÃ  next-on-pages
          # Náº¿u báº¡n Ä‘Ã£ cáº­p nháº­t scripts trong package.json, thÃ¬ chá»‰ cáº§n gá»i script Ä‘Ã³.
          command: pnpm run build 
          
          # ThÆ° má»¥c Output: Sau khi cháº¡y next-on-pages, output sáº½ náº±m á»Ÿ Ä‘Ã¢y
          directory: .vercel/output/static 
          
          # Cáº¥u hÃ¬nh cho Next.js
          framework: next