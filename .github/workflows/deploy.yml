name: Deploy Next.js to Cloudflare Pages

on:
  push:
    branches:
      - main 

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: â¬‡ï¸ Checkout code
        uses: actions/checkout@v4

      - name: âš™ï¸ Setup Node.js (Cho pnpm cache)
        # BÆ°á»›c nÃ y chá»‰ cáº§n thiáº¿t láº­p mÃ´i trÆ°á»ng Node.js vÃ  cache.
        # Action Deploy bÃªn dÆ°á»›i sáº½ tá»± gá»i pnpm install.
        uses: actions/setup-node@v4
        with:
          node-version: '20' 
          cache: 'pnpm'
          
      # XÃ“A BÆ¯á»šC: ğŸ“¦ Install pnpm (npm install -g pnpm)
      # XÃ“A BÆ¯á»šC: ğŸ“¦ Install dependencies (pnpm install)

      - name: ğŸ› ï¸ Build and Deploy (Sá»­ dá»¥ng Cloudflare Action)
        uses: cloudflare/pages-action@v1
        with:
          apiToken: ${{ secrets.CLOUDFLARE_API_TOKEN }}
          accountId: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }}
          projectName: ptit 
          
          # Action sáº½ tá»± Ä‘á»™ng cháº¡y lá»‡nh nÃ y sau khi tá»± Ä‘á»™ng cÃ i Ä‘áº·t dependencies
          command: pnpm run build 
          
          # Output cá»§a OpenNext
          directory: .open-next/assets
          
          framework: next