name: Deploy Next.js to Cloudflare Pages

on:
  push:
    branches:
      - main 

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: â¬‡ï¸ Checkout code
        uses: actions/checkout@v4

      # 1. SETUP NODE.JS (KHÃ”NG DÃ™NG cache: pnpm á» ÄÃ‚Y)
      - name: âš™ï¸ Setup Node.js (Chá»‰ thiáº¿t láº­p mÃ´i trÆ°á»ng)
        uses: actions/setup-node@v4
        with:
          node-version: '20' 
          # KHÃ”NG cÃ³ cache: 'pnpm' á»Ÿ Ä‘Ã¢y Ä‘á»ƒ trÃ¡nh gá»i pnpm quÃ¡ sá»›m.
          
      # 2. CÃ€I Äáº¶T PNPM EXECUTABLE (BÆ¯á»šC Sá»¬A Lá»–I)
      - name: ğŸ“¦ Install pnpm executable
        uses: pnpm/action-setup@v3
        with:
          version: 8 
          run_install: false # Váº«n khÃ´ng cháº¡y install á»Ÿ Ä‘Ã¢y

      # 3. CHáº Y BUILD & DEPLOY (Action nÃ y sáº½ tá»± Ä‘á»™ng cháº¡y pnpm install vÃ  pnpm run build)
      # Action nÃ y sáº½ tá»± Ä‘á»™ng xá»­ lÃ½ caching pnpm vÃ  cháº¡y lá»‡nh build/deploy.
      - name: ğŸ› ï¸ Build and Deploy
        uses: cloudflare/pages-action@v1
        with:
          apiToken: ${{ secrets.CLOUDFLARE_API_TOKEN }}
          accountId: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }}
          projectName: ptit 
          
          # Cáº§n Ä‘áº£m báº£o ráº±ng cÃ¡c Secrets Ä‘Ã£ Ä‘Æ°á»£c thiáº¿t láº­p.
          command: pnpm run build 
          
          directory: .open-next/assets
          
          framework: next