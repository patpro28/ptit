name: Deploy Next.js to Cloudflare Pages

on:
  push:
    branches:
      - main 

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: ‚¨áÔ∏è Checkout code
        uses: actions/checkout@v4

      # 1. Setup Node.js (Cho m√¥i tr∆∞·ªùng v√† cache)
      - name: ‚öôÔ∏è Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20' 
          cache: 'pnpm'
          
      # 2. C√ÄI ƒê·∫∂T PNPM R√ï R√ÄNG
      - name: üì¶ Install pnpm
        uses: pnpm/action-setup@v3
        with:
          version: 8 
          run_install: false # Kh√¥ng ch·∫°y pnpm install ·ªü ƒë√¢y, ƒë·ªÉ action Pages x·ª≠ l√Ω
          
      # 3. BUILD V√Ä DEPLOY
      - name: üõ†Ô∏è Build and Deploy
        uses: cloudflare/pages-action@v1
        with:
          apiToken: ${{ secrets.CLOUDFLARE_API_TOKEN }}
          accountId: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }}
          projectName: ptit 
          
          # Action Pages s·∫Ω t·ª± ƒë·ªông t√¨m v√† ch·∫°y l·ªánh n√†y,
          # v√† n√≥ s·∫Ω ch·∫°y pnpm install tr∆∞·ªõc ƒë√≥ (v√¨ n√≥ t·ª± ph√°t hi·ªán pnpm)
          command: pnpm run build 
          
          directory: .open-next/assets
          
          framework: next