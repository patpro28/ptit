name: Deploy Next.js to Cloudflare Pages

on:
  push:
    branches:
      - main 

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: ‚¨áÔ∏è Checkout code
        uses: actions/checkout@v4

      # 1. SETUP NODE.JS (Thi·∫øt l·∫≠p m√¥i tr∆∞·ªùng v√† k√≠ch ho·∫°t cache pnpm)
      - name: ‚öôÔ∏è Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20' 
          cache: 'pnpm' 
          
      # 2. C√ÄI ƒê·∫∂T PNPM (C·∫ßn thi·∫øt v√¨ Setup Node kh√¥ng ƒë·∫£m b·∫£o pnpm n·∫±m trong PATH)
      # B∆∞·ªõc n√†y ƒë·∫£m b·∫£o pnpm executable c√≥ s·∫µn cho c√°c b∆∞·ªõc sau.
      - name: üì¶ Install pnpm executable
        uses: pnpm/action-setup@v3
        with:
          version: 8 
          run_install: false # KH√îNG ch·∫°y pnpm install ·ªü ƒë√¢y

      # 3. BUILD V√Ä DEPLOY (Action n√†y s·∫Ω t·ª± ƒë·ªông ch·∫°y pnpm install v√† pnpm run build)
      - name: üõ†Ô∏è Build and Deploy
        uses: cloudflare/pages-action@v1
        with:
          apiToken: ${{ secrets.CLOUDFLARE_API_TOKEN }}
          accountId: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }}
          projectName: ptit 
          
          # L·ªánh n√†y s·∫Ω ƒë∆∞·ª£c action Pages t·ª± ƒë·ªông ch·∫°y sau khi t·ª± ƒë·ªông ch·∫°y pnpm install 
          command: pnpm run build 
          
          directory: .open-next/assets
          
          framework: next